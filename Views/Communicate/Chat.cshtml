@model List<TALENTSPHERE.Models.Message>
@using TALENTSPHERE.Helpers
@using TALENTSPHERE.Controllers
@using System.Text.Json;

<style>
    /* Стили для боковой панели */
    #chat-sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    width: 250px;
    background-color: #f8f9fa;
    border-right: 1px solid #dee2e6;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    z-index: 1050;
    }
    /* Заголовок */
    #chat-sidebar-header {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
    }
    /* Контейнер с содержимым (скроллируемый) */
    #chat-list-container {
    overflow-y: auto;
    flex-grow: 1;
    padding: 0 1rem;
    }

    #comment-input-container {
    position: fixed;
    bottom: 10px; /* небольшой отступ снизу */
    left: 250px; /* чтобы сдвинуть влево от края страницы (учитывая левую панель) */
    right: 20px; /* небольшой отступ справа */
    z-index: 1050; /* чтобы он был сверху остальных элементов */
    background: #f8f9fa; /* или прозрачный, если нужно */
    padding: 0.5rem; /* небольшой отступ внутри */
    box-shadow: 0 0 5px rgba(0,0,0,0.2); /* легкая тень */
    border-radius: 0.25rem; /* скругление углов */
    }
    /* Стиль для каждого чата */
    .chat-item {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background-color: #ffffff;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: background-color 0.2s;
    }

    .chat-item:hover {
    background-color: #e9ecef;
    }
</style>

<div id="chat-sidebar">
    <div id="chat-sidebar-header" class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Чаты</h5>
        <!-- Можно добавить кнопку закрытия/открытия -->
    </div>
    <div id="chat-list-container">
        <!-- Здесь можно динамически добавлять чаты -->
        @{
            var chats = ViewBag.ChatList as ChatsList[];
        }
        @if (chats != null) 
        {
            @foreach (var i in chats) {
                if (i.Name == null) {
                    continue;
                }
                @ChatHelpers.GenerateChatIcon(i.Id.ToString(), i.Name);
            }
        }
    </div>
</div>


<div id="join">
    <label>Id пользователя</label>
    <input type="text" id="inputUser" value="@ViewData["IdUser"]" />
    <br>
    <label>Id чата</label>
    <input type="text" id="inputChat" value="@ViewData["IdChat"]" />

    <input id="inputLogin" type="text" value="@ViewData["LoginUser"]" />
    <input id="inputEmail" type="text" value="@ViewData["EmailUser"]" />

    <button id="joinButton">Подключиться</button>
</div>

<body class="d-flex flex-column min-vh-100 bg-light py-4">

    <div style="margin-left: 250px; padding: 1rem;">

        <div id="messages" class="container flex-fill d-flex flex-column justify-content-end">
            <h2 class="mb-4 text-center">Чат</h2>

            <!-- Область сообщений -->
            <div id="messageList" class="mb-4" style="flex-grow:1; overflow-y:auto; max-height: 70vh;">
                <!-- Вставляйте сообщения сюда вручную -->
                @{
                    var receipedLogin = ViewData["LoginUser"] as string ?? "";
                }
                @if (Model != null) {
                    @foreach (var item in Model)
                    {
                        var messageText = item.Body != null ? item.Body : "Unknown";
                        var ownerLogin = item.OwnerLogin ?? "Unknown";
                        var createTime = item.CreateTime.ToString() != null ? item.CreateTime.ToString() : "Unknown";

                        @ChatHelpers.GenerateMessage(messageText, ownerLogin, receipedLogin, createTime)
                    }
                }
        </div>

        <!-- Поле ввода -->
        <div id="comment-input-container">
            <div class="input-group">
                <input id="inputMessage" type="text" class="form-control" placeholder="Введите сообщение..." aria-label="Сообщение" required />
                <button id="sendButton" class="btn btn-primary" type="submit">Отправить</button>
            </div>
        </div>
    </div>

    </div>

</body>


<div id="templatesContainer" style="display: none">

    <div id="myMessageExample" class="d-flex justify-content-start my-4">
        <div class="card bg-primary text-white" style="max-width: 75%;">
            <div class="card-body p-2">
                <p id="txtBody" class="mb-1"></p>
            </div>
            <div class="card-footer bg-primary text-end small">
                <span id="nameBody">Имя пользователя</span> | <span id="time"></span>
            </div>
        </div>
    </div>

    <div id="otherMessageExample" class="d-flex justify-content-start my-4">
        <div class="card bg-secondary text-white" style="max-width: 75%;">
            <div class="card-body p-2">
                <p id="txtBody" class="mb-1"></p>
            </div>
            <div class="card-footer bg-secondary text-start small">
                <span id="nameBody">Имя другого</span> | <span id="time"></span>
            </div>
        </div>
    </div>

    <div id="chatExample" class="chat-item"></div>
</div>

<script src="/js/signalr/dist/browser/signalr.js"></script>  
@* <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script> *@
<script src="/js/chat.js"></script>